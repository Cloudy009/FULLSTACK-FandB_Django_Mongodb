Djongo lÃ  má»™t thÆ° viá»‡n cho phÃ©p ta dÃ¹ng MongoDB nhÆ° má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u backend trong Django, 
mÃ  khÃ´ng cáº§n viáº¿t Mongo query.
Thay vÃ o Ä‘Ã³, 
ta dÃ¹ng ORM quen thuá»™c cá»§a Django, 
vÃ  Djongo sáº½ dá»‹ch cÃ¡c truy váº¥n SQL sang MongoDB phÃ­a sau háº­u trÆ°á»ng.

djongo/
â”œâ”€â”€ base.py                 â† Quáº£n lÃ½ káº¿t ná»‘i & tÃ­ch há»£p ORM
â”œâ”€â”€ cursor.py               â† Giao tiáº¿p vá»›i MongoDB (thá»±c thi truy váº¥n)
â”œâ”€â”€ operations.py           â† Thá»±c thi cÃ¡c lá»‡nh nhÆ° INSERT, UPDATE
â”œâ”€â”€ introspection.py        â† DÃ¹ng khi cháº¡y migrate
â”œâ”€â”€ schema.py               â† Giáº£ láº­p schema (Mongo khÃ´ng cÃ³ schema)
â””â”€â”€ sql2mongo/
    â”œâ”€â”€ query.py            â† PhÃ¢n tÃ­ch truy váº¥n SQL
    â”œâ”€â”€ converters.py       â† Dá»‹ch sang Mongo query
    â”œâ”€â”€ translator.py       â† Bá»™ chuyá»ƒn Ä‘á»•i chÃ­nh tá»« SQL â†’ Mongo

âœ… djongo.base.DatabaseWrapper
ÄÃ¢y lÃ  file cá»±c quan trá»ng. 
NÃ³ káº¿ thá»«a tá»« Djangoâ€™s BaseDatabaseWrapper vÃ  gáº¯n káº¿t toÃ n bá»™ hoáº¡t Ä‘á»™ng ORM vÃ o MongoDB.

# djongo/base.py
class DatabaseWrapper(BaseDatabaseWrapper):
    vendor = 'djongo'

    def get_connection_params(self):
        return {
            'name': self.settings_dict.get('NAME'),
            ...
        }

    def get_new_connection(self, conn_params):
        # Táº¡o MongoClient káº¿t ná»‘i tá»›i MongoDB
        return connect(
            db=conn_params['name'],
            host=conn_params['host'],
            ...
        )

    def create_cursor(self, name=None):
        # Tráº£ vá» cursor dÃ¹ng Ä‘á»ƒ thá»±c hiá»‡n truy váº¥n
        return Cursor(self.connection)

âœ… djongo/cursor.py: # djongo/cursor.py
# djongo/cursor.py
class Cursor:
    def execute(self, sql, params=None):
        self.db_ops = SQLCompiler(sql, params)
        self.db_ops.execute()

    def fetchone(self):
        return self.db_ops.result.fetchone()
Nháº­n SQL tá»« Django ORM
Gá»i SQLCompiler (bÃªn trong sql2mongo) Ä‘á»ƒ dá»‹ch SQL sang Mongo query
Gá»­i truy váº¥n tá»›i MongoDB vÃ  tráº£ vá» káº¿t quáº£

âœ… djongo/sql2mongo/translator.py
# djongo/sql2mongo/translator.py
class Translator:
    def translate(self, sql):
        parsed = self._parse(sql)
        mongo_query = self._convert_to_mongo(parsed)
        return mongo_query
Nháº­n cÃ¢u SQL (do Django táº¡o ra)
PhÃ¢n tÃ­ch nÃ³ (parse)
Dá»‹ch sang cÃ¢u lá»‡nh Mongo (dictionary query)

âœ… 4. djongo/operations.py
Há»— trá»£ lá»‡nh INSERT, UPDATE, DELETE
Djongo sáº½ xá»­ lÃ½ vÃ  chuyá»ƒn thÃ nh thao tÃ¡c ghi tÆ°Æ¡ng á»©ng cá»§a Mongo.


âœ… 5. djongo/schema.py â€“ Giáº£ láº­p schema
MongoDB lÃ  NoSQL, khÃ´ng cÃ³ khÃ¡i niá»‡m schema nhÆ° SQL. NhÆ°ng Django thÃ¬ cáº§n migrate, makemigrations...
ğŸ‘‰ File nÃ y giÃºp giáº£ láº­p má»™t schema táº¡m thá»i, Ä‘á»ƒ Django khÃ´ng bá»‹ lá»—i khi cháº¡y cÃ¡c lá»‡nh makemigrations, migrate.


ğŸ” Quy trÃ¬nh hoáº¡t Ä‘á»™ng khi báº¡n gá»i ORM
âœ… BÆ°á»›c 1: Giáº£ sá»­ báº¡n cÃ³ model trong Django
# models.py
from django.db import models

class Book(models.Model):
    title = models.CharField(max_length=100)
    author = models.CharField(max_length=100)
VÃ  báº¡n Ä‘Ã£ cháº¡y makemigrations + migrate, Djongo sáº½ tá»± táº¡o collection book trong MongoDB.

âœ… BÆ°á»›c 2: Báº¡n gá»i cÃ¢u ORM trong view hoáº·c shell
Book.objects.filter(title='Python')

ğŸ” Quy trÃ¬nh hoáº¡t Ä‘á»™ng tá»«ng bÆ°á»›c bÃªn trong Djongo
ğŸ§© BÆ°á»›c 3: Django ORM táº¡o ra SQL
Django ná»™i bá»™ chuyá»ƒn cÃ¢u lá»‡nh ORM nÃ y thÃ nh SQL sau:
SELECT "book"."id", "book"."title", "book"."author"
FROM "book"
WHERE "book"."title" = 'Python'

ğŸ§© BÆ°á»›c 4: Django gá»i DatabaseWrapper.create_cursor() tá»« base.py
# base.py
def create_cursor(self, name=None):
    return Cursor(self.connection)
Tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng Cursor.

ğŸ§© BÆ°á»›c 5: Gá»i cursor.execute(sql) â†’ dá»‹ch SQL sang Mongo
# cursor.py
class Cursor:
    def execute(self, sql, params=None):
        self.db_ops = SQLCompiler(sql, params)
        self.db_ops.execute()
Trong Ä‘Ã³:
SQLCompiler gá»i tiáº¿p tá»›i Translator bÃªn trong djongo/sql2mongo/translator.py.

ğŸ§© BÆ°á»›c 6: Translator phÃ¢n tÃ­ch SQL â†’ Mongo
# translator.py
class Translator:
    def translate(self, sql):
        parsed = self._parse(sql)
        mongo_query = self._convert_to_mongo(parsed)
        return mongo_query
Vá»›i SQL á»Ÿ trÃªn, Translator sáº½ táº¡o ra MongoDB query tÆ°Æ¡ng Ä‘Æ°Æ¡ng:
{
    'filter': {'title': 'Python'},
    'projection': {'_id': 1, 'title': 1, 'author': 1},
    'collection': 'book'
}

ğŸ§© BÆ°á»›c 7: Gá»­i truy váº¥n Mongo qua pymongo
Djongo dÃ¹ng pymongo Ä‘á»ƒ thá»±c hiá»‡n:
db['book'].find(
    {'title': 'Python'},
    {'_id': 1, 'title': 1, 'author': 1}
)
MongoDB sáº½ tráº£ vá» káº¿t quáº£:
[
    {"_id": ObjectId("..."), "title": "Python", "author": "John Doe"}
]

ğŸ§© BÆ°á»›c 8: Djongo tráº£ káº¿t quáº£ vá» Django ORM
Djongo sáº½ convert má»—i document MongoDB thÃ nh object Book:
Book(id=..., title='Python', author='John Doe')
VÃ  káº¿t quáº£ sáº½ lÃ  má»™t QuerySet chá»©a cÃ¡c object Book.

âœ… TÃ³m láº¡i quy trÃ¬nh vá»›i sÆ¡ Ä‘á»“ chá»¯:
Book.objects.filter(title='Python')
        â†“
Django ORM â†’ SQL: SELECT * FROM book WHERE title='Python'
        â†“
Djongo.base.DatabaseWrapper.create_cursor()
        â†“
cursor.execute(sql)
        â†“
â†’ Translator.translate(sql)
        â†“
â†’ MongoDB query: db.book.find({'title': 'Python'})
        â†“
â†’ Nháº­n káº¿t quáº£ tá»« MongoDB
        â†“
â†’ Convert â†’ [Book(...), Book(...)]